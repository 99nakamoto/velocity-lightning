<%- include("../layouts/head",{type:'wallet'}) %>
    <h1 style="text-align: center;">我的钱包</h1>
	<div class="container">
		<form class="form create" method="post">
			<div>
				账户余额：<%= account_balance %> XLM
			</div>
			<div>
				通道余额：<%= channel_balance %> XLM
            </div>
            <h3>使用账户余额转账</h3>
            <div>
                <label>对方Name：</label>
                <input placeholder="对方Name" type="text" name="name" />
            </div>
            <div>
                <label>转账金额：</label>
                <input placeholder="转账金额" type="number" min="0" name="amount" />
            </div>
			<div class="submit">确定</div>
        </form>
        <h3 style="text-align: center;margin-top: 100px;">历史记录</h3>
        <ul class="posts" style="width: 50%;margin: 0 auto;margin-top: 10px;">
            <li>
                <div class="title" style="margin-left: 0px;">
                    对方Name:bob
                </div>
                <span>+10XLM</span>
            </li>
            <li>
                <div class="title" style="margin-left: 0px;">
                    对方Name:bob
                </div>
                <span>+10XLM</span>
            </li>
        </ul>
        <div style="margin-top: 30px" class="pagination" id="page"></div>	
	</div>
	<script src="/js/pagination.js"></script>
	<script>
        pagination({
			selector: '#page',
			totalPage: 1,
			currentPage: 1,
			prev: '上一页',
			next: '下一页',
			first: true,
			last: true,
			showTotalPage: true,
			count: 2//当前页前后显示的数量
		}, function(val) {
			$.ajax({
				url : "channel-list",
				type : 'POST',
				data : {
					page : val
				},
				cache : false,
				success: function (data) {
					if (data != 'error') {
						$('.posts').html(' ')
						$.each(data,function(i,val){
							var status = '<span style="height: 26px;background: ' 
							status += val.channel_status==1?"#5FB878":"red"
							status += ';width: 26px;border-radius: 50%;"></span>';
							console.log(status)
							$('.posts').append(
								'<li>'+
									'<a href="/channel-details/'+ val.channel_id +'">'+
										'<div class="title">'+
											val.channel_name + status +
										'</div>'+
									'</a>'+
								'</li>'
							)
						})
					} else {
						fend('分页不存在')
					}
				}
			})
		})
		$(window).keyup(function (e) {
			if (e.keyCode == 13) {
				$('.submit').click()
			}
		})
		$('.submit').click(()=>{
			if ($('input[name=name]').val().trim() == '') {
				fade('请输入对方用户名！')
			} else if ($('input[name=amount]').val()<=0) {
				fade('请输入正确金额！')
			} else {
				$.ajax({
					url: "/wallet",
					data: {
						name: $('input[name=name]').val(),
						amount: $('input[name=amount]').val(),
					},
					type: "POST",
					cache: false,
					dataType: 'json',
					success: function (data) {
					   if (data.message == '用户存在') {
						   $('input').val('')
						   fade('用户名存在')
					   } else if(data.message == '转账成功') {
							fade('转账成功')
							setTimeout(()=>{
								location.reload();
							},1000)
					   	} else {
							fade(data.message)
					   	}
					},
					error: function () {
						fade('异常')
					}
				})			
			}
		})		
	</script>
<%- include ../layouts/foot %>